---
title: "Introduction to Image Preprocessing"
author: "Ted Laderas"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: xaringan-themer.css
    nature:
      ratio: '16:9'
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---
```{r xaringan-themer, include = FALSE}
library(xaringanthemer)
mono_light(
  base_color = "midnightblue",
  header_font_google = google_font("Josefin Sans"),
  text_font_google   = google_font("Montserrat", "300", "300i"),
  code_font_google   = google_font("Droid Mono"),
  link_color = "deepskyblue1",
  text_font_size = "28px"
)
```


# Sharing Session

- For 10 minutes a class, we'll discuss assignments

---
# Learning Objectives

- **Learn** about *histograms* and **use** them to understand the distribution of values in an image
- **Learn** about *numerical transformations* on image data and how to **apply** them to images
- **Learn** about *log transformation* and **assess** its effect on image data
- Learn about *filtering* and *denoising* images

---
# Glossary

- **transformation** - performing a numeric operation on the pixel values of an image
- **global** transformations - an operation that is applied to all of the pixel values at once. Also known as **point operations**.
- **local transformations** - an operation that is applied one pixel at a time, usually dependent on the *neighborhood* of this pixel. 
- **filtering** - a specific type of *local transformation* that uses a pixel value and the value of its neighboring pixels
- **neighborhood** - an area of pixels that is centered around one pixel. The smallest neighborhood is 3 pixels by 3 pixels = 9 pixels total, which form a "moat" around the center pixel.

---
# What are some problems with Microscope Images?

- Noise (often from Exposure)
- Uneven Illumination
- Overexposure/Photobleaching
- Part of your reading: [Fluoresecence Microscopy: Avoiding the Pitfalls.](https://jcs.biologists.org/content/joces/120/10/1703.full.pdf)

---
# First Do No Harm

- Do as little as possible to images when preprocessing them.
- Be Transparent and share your workflow

---
# Point operations

```
image + 0.2
```

```
image * 2
```

???

- Point operations, also known as **global** operations, are mathematical operations that operate on all of the pixels in an image
- We can do things like add a value (0.1) to all pixels, or subtract values.

---
# Normalization

- Scale depth of image to fit minimums and maximums of image

.pull-left[<img src="image/week2/darker_image.png" width= 400>]

.pull-right[<img src="image/week2/lighter_image.png" width = 400>]

---
# Compare Histograms

.pull-left[<img src="image/week2/hist_darker.png" width = 400 >]

.pull-right[<img src="image/week2/hist_lighter.png" width = 400 >]

---
<img src = "image/week2/masking.JPG" width = 800>

???

- One type of point operation that is very useful is *masking*, where a "region of interest" is defined in our image.
- We may want to remove certain parts of the image, because they are not an area of the image that we are intersted in
- You can define a region of interest mathematically, or by drawing it in manually
- Everything not in the region of interest gets zeroed out (becomes black)

---
# Noise in fluoresence microscopy

- Noise around an object can affect the *shape*, or *border* of the object that is detected
- We'll investigate the sources of noise further later
- Can affect the area that is measured for the object
- Can we fix this? Yes, we can, with *filters*!

---
<img src="image/week2/neighborhood.JPG" width = 800>

???

- The first concept we need to define with a filter is a *neighborhood*.
- The neighborhood is defined as the pixels that surround a pixel of interest (including the pixel of interest)
- We utilize intensity values of the pixels in the neighborhood to transform the intensity value of our pixel of interest
- Neighborhoods can have different shapes, square, circular, or other shapes
- The matrix on the right is our image before filtering. We're using integer values here just because it's easier
- The pixel of interest is in green, and its 3x3 neighborhood are those pixels that surround it

---

# Filtering using a mean filter

.pull-left[
- Applying an operation using values around a pixel, or the pixel neighborhood
- Take all nine values in a neighborhood, multiply by 1/9, and then add them
- The "1/9" is known as a weight
- They're also called *convolutional* filters
]

.pull-right[
  ![](image/week2/mean_filter.png)
]

.footnote[https://petebankhead.gitbooks.io/imagej-intro/content/chapters/filters/filters.html]

---
<img src="image/week2/mean_filter1.JPG" width=800>

---
<img src="image/week2/mean_filter_your_turn.JPG" width =800>
---
# What about the edges?

<img src="image/week2/filter_edges.JPG" width =800>

---
<img src="image/week2/borders.png" width=800>

---
# Variations: Median Filtering

.pull-left[
- Sort all values, and return the center value
- "ignores" extreme values in a neighborhood.
]

.pull-right[
  ![](image/week2/median_filtering.png)
]

.footnote[https://petebankhead.gitbooks.io/imagej-intro/content/chapters/filters/filters.html]
---
# Mean vs Median: One ignores the "extreme" values

![](image/week2/median_vs_mean.png)

---
# Variations: Gaussian Filters

- Neighborhood and its weight are defined by 2-D *gaussian* functions around a point
- Avoids "blockiness"

   ![](image/week2/gaussian_filter.png)

---
# What about Photoshop?

- Almost all effects in photoshop are global or local manipulations on an image.
- Neighborhoods are defined differently (also known as "brushes")

---
# Take home points

- We can transform images with either **global** or **local** operations
- **Global operations**: transforming the data, including addition, subtraction, and scaling, or normalizing the data 
- We assess the effects of *global operations* by looking at the histogram
- **Local operations**: filtering, including mean filtering, median filtering, and gaussian filtering
- We assess the effects of local operations by examining the image and seeing the effect of the filter on downstream operations
- **Neighborhoods** define which pixel values we incorporate into a local operation

---
# Reading

Please read these sections before the lab.

- [Processing and Analysis](https://petebankhead.gitbooks.io/imagej-intro/content/chapters/processing_and_analysis/processing_and_analysis.html)
- [Point Operations](https://petebankhead.gitbooks.io/imagej-intro/content/chapters/point_operations/point_operations.html)